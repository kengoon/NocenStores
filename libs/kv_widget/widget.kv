#:import MDDropdownMenu kivymd.uix.menu.MDDropdownMenu
#:import MDBoxLayout kivymd.uix.boxlayout.MDBoxLayout
#:import MDLabel kivymd.uix.label.MDLabel
<OtherSalesCard@SalesCard>
    radius: [dp(6)]
<SalesCard@MDCard>:
    source: ""
    text: ""
    elevation: 0
    #radius: [dp(6)]
    product_name: ""
    product_price: 0
    text_radius: [dp(5)]
    product_owner: ""
    #text_color: [1, 1, 1, 1]
    orientation: "vertical"
    on_release:
        print(image.source, self.source)
    RelativeLayout:
        AsyncImage:
            id: image
            color: 0, 0, 0, 0
            source: root.source
            anim_delay: .1
            allow_stretch: True
            keep_ratio: False
            on_source:
                loader.opacity = 0
                self.color = [1, 1, 1, 1]
            canvas.before:
                StencilPush
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [root.radius[0], root.radius[0], 0, 0]
                StencilUse

            canvas.after:
                StencilUnUse
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [root.radius[0], root.radius[0], 0, 0]
                StencilPop
        M_AKImageLoader:
            id: loader
            radius: [root.radius[0], root.radius[0], 0, 0]
            circle: False
    MDBoxLayout
        adaptive_height: True
        padding: dp(10)
        M_AKLabelLoader:
            text:
                "" if not ((root.product_price and root.product_name) or root.text) else\
                f"{root.product_name}\n[b][color={get_hex_from_color(app.theme_cls.primary_color)}]₦{root.product_price:,}[/color][/b]" \
                if root.product_price and root.product_name else\
                root.text
            radius: root.text_radius
            size_hint_y: None
            markup: True
            theme_text_color: "Custom"
            text_color: app.theme_cls.text_color
            height: dp(20) if not self.text else self.texture_size[1]
            font_size: dp(17)
            #font_style: "Money"
            halign:"left"
            pos_hint:{"center_y": .5}

<Sales2Card@MDCard>:
    elevation: 0
    source: ""
    #radius: [dp(15)]
    store: ""
    product_name: ""
    product_price: int()
    text_radius: [dp(5)]
    product_owner: ""
    #text_color: [1, 1, 1, 1]
    orientation: "vertical"
    rates: rates
    RelativeLayout:
        AsyncImage:
            id: image
            color: 0, 0, 0, 0
            source: root.source
            anim_delay: .1
            allow_stretch: True
            keep_ratio: True #if app.image_has_transparency(self, self.source) else False
            on_load:
                loader.opacity = 0
                self.color = [1, 1, 1, 1]
            canvas.before:
                StencilPush
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [root.radius[0], root.radius[0], 0, 0]
                StencilUse

            canvas.after:
                StencilUnUse
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [root.radius[0], root.radius[0], 0, 0]
                StencilPop
        M_AKImageLoader:
            id: loader
            radius: [root.radius[0], root.radius[0], 0, 0]
            circle: False
        MDBoxLayout:
            id:box
            padding: dp(10)
            adaptive_height: True
            md_bg_color: 0, 0, 0, .4
            radius: [0, 0, 0, 0]
            M_AKLabelLoader:
                text: "" if not root.store else f"Store: {root.store}"
                radius: root.text_radius
                size_hint_y: None
                theme_text_color: "Custom"
                text_color: 1, 1, 1, 1
                height: dp(20) if not self.text else self.texture_size[1]
                font_style: "Money"
                font_size: dp(16)
                halign:"left"
            AKRating:
                id: rates
                normal_icon: 'star-outline'
                active_icon: 'star'
                animation_type: 'grow'
                normal_color: 1,1,1,.8
                active_color: app.theme_cls.primary_color
                icon_size: dp(20)
                disabled: True
                pos_hint: {"center_x": .5}
    MDBoxLayout
        adaptive_height: True
        padding: dp(10)
        M_AKLabelLoader:
            text:
                "" if not (root.product_price and root.product_name) else \
                f"{root.product_name}\n[b][color={get_hex_from_color(app.theme_cls.primary_color)}]₦{root.product_price:,}[/color][/b]"
            radius: root.text_radius
            size_hint_y: None
            markup: True
            theme_text_color: "Custom"
            text_color: app.theme_cls.text_color
            height: dp(20) if not self.text else self.texture_size[1]
            font_size: dp(17)
            halign:"left"
            pos_hint:{"center_y": .5}

        MDIconButton:
            icon: "cart-variant"
            on_release: root.root.root.manager.current = "lookout"

        MDIconButton:
            icon: "information-outline"
            menu: MDDropdownMenu(caller=self, width_mult=3)
            detail: "hello world, welcome to nocenstore, continue shopping goods, buy anything and get everything"
            label: MDLabel(text=self.detail, markup=True, font_style="Caption", color=app.theme_cls.disabled_hint_text_color)
            on_release:
                app.open(self.menu, self.label)
                #self.menu.ids.md_menu.add_widget(MDBoxLayout())


<UserActivity@MDGridLayout>:
    cols: 1
    #spacing: dp(5)
    adaptive_height: True
    text: ["", ""]
    icon: ""
    icon_color: get_color_from_hex("#2196F3")
    customer: total
    MDIcon:
        icon: root.icon
        disabled: True
        halign: "center"
        color: root.icon_color
        size_hint_y: None
        height: self.texture_size[1]
        font_size: dp(17)
    MDLabel:
        text: root.text[0]
        font_style: "Money"
        disabled: True
        halign: "center"
        font_size: "12sp"
        size_hint_y: None
        height: self.texture_size[1]

    MDLabel:
        id: total
        text: root.text[1]
        disabled: True
        font_style: "Money"
        halign: "center"
        size_hint_y: None
        font_size: "15dp"
        height: self.texture_size[1]

<CategoryCard@MDCard>:
    elevation: 0
    source: ""
    text: ""
    #radius: [dp(10)]
    size_hint_y: None
    height: self.minimum_height
    product_name: ""
    product_price: 0
    text_radius: [dp(5)]
    product_owner: ""
    #text_color: [1, 1, 1, 1]
    orientation: "vertical"
    on_release:
        print(image.source, self.source)
    RelativeLayout:
        size_hint_y: None
        height: root.width
        #height: Window.height/4
        AsyncImage:
            id: image
            color: 0, 0, 0, 0
            source: root.source
            anim_delay: .1
            allow_stretch: True
            keep_ratio: False

            on_source:
                loader.opacity = 0
                self.color = [1, 1, 1, 1]
            canvas.before:
                StencilPush
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [root.radius[0], root.radius[0], 0, 0]
                StencilUse

            canvas.after:
                StencilUnUse
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [root.radius[0], root.radius[0], 0, 0]
                StencilPop
        M_AKImageLoader:
            id: loader
            radius: [root.radius[0], root.radius[0], 0, 0]
            circle: False
    MDBoxLayout
        adaptive_height: True
        padding: dp(10)
        orientation:"vertical"
        MDLabel:
            text: root.text
            size_hint_y: None
            height: self.texture_size[1]
            font_style: "Money"
            font_size: "11dp"
            valign: "top"
            halign: "center"
#        AKRating:
#            id: rates
#            normal_icon: 'star-box-outline'
#            active_icon: 'star-box'
#            animation_type: 'grow'
#            normal_color: app.theme_cls.disabled_hint_text_color
#            active_color: app.theme_cls.primary_color
#            icon_size: dp(17)
#            disabled: True
#            pos_hint: {"center_x": .5}
#        MDBoxLayout:
#            adaptive_height: True
#            UserActivity:
#                text: ["sold", "0"]
#                icon: "shield-check"
#                icon_color: 1,0,0.4,1
#
#            UserActivity:
#                text: ["products", "0"]
#                icon: "shopping"
#                icon_color: 0, .6, 0, 1
<NewProductCard@BaseProductCard>
    on_release:
        self.parent.root.current = "lookout"

<CategoryProductCard@BaseProductCard>
    on_release:
        self.parent.root.current = "lookout"
<BaseProductCard@MDCard>:
    ripple_behavior: True
    size_hint_y: None
    height: self.minimum_height
    source: ""
    #elevation: 10
    store: ""
    product_name: ""
    product_price: int()
    text_radius: [dp(5)]
    product_owner: ""
    rates: rates
    radius: [dp(10)]
    FitImage:
        source: root.source
        size_hint_x: None
        width: root.width/2.2
        radius:[root.radius[0], 0, 0, root.radius[0]]
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(10)
        M_AKLabelLoader:
            text:
                "" if not (root.product_price and root.product_name) else \
                f"[font=assets/Eczar-Regular.ttf]{root.product_name}[/font]\n[b][color={get_hex_from_color(app.theme_cls.primary_color)}]₦{root.product_price:,}[/color][/b]"
            radius: root.text_radius
            size_hint_y: None
            markup: True
            theme_text_color: "Custom"
            text_color: app.theme_cls.text_color
            height: dp(20) if not self.text else self.texture_size[1]
            font_size: dp(17)

        AKRating:
            id: rates
            normal_icon: 'star-box-outline'
            active_icon: 'star-box'
            animation_type: 'grow'
            normal_color: app.theme_cls.disabled_hint_text_color
            active_color: app.theme_cls.primary_color
            icon_size: dp(20)
            disabled: True
            #pos_hint: {"center_x": .5}
        MDLabel:
            text: f"[color=388E3C]store:[/color] " + root.store
            #color: get_color_from_hex("388E3C")
            font_style: "Money"
            markup: True

        MDBoxLayout:
            adaptive_height: True
            size_hint_x: None
            width: self.parent.width/2
            md_bg_color: 0,1,0,.1
            radius: [dp(5)]
            MDLabel:
                id: la
                text: "NOCENSTORE"
                font_style: "Money"
                italic: True
                color: app.theme_cls.primary_color
                size_hint_y: None
                height: self.texture_size[1]
                halign: "center"
                font_size: dp(13)





<CardIconButton@MDCard>:
    icon_width: None
    size_hint_y: None
    height: self.minimum_height
    text: ""
    icon: ""
    icon_color: 0, 0, 0, 1
    text_color: 0, 0, 0, 1
    font_style: "Caption"
    elevation: 8
    icon_halign: "left"
    label_halign: "left"
    spacing: dp(10)
    padding: dp(13)
    ripple_behavior: True
    radius: [dp(10)]
    MDIcon:
        id: icon
        halign: root.icon_halign
        icon: root.icon
        color: root.icon_color
        size_hint_x: None
        width: self.texture_size[0] if not root.icon_width else root.icon_width

    MDLabel:
        halign: root.label_halign
        text: root.text
        color: root.text_color
        size_hint_y: None
        font_style: root.font_style
        height: self.texture_size[1]

<ProductCard@MDCard>
    background: ""
    radius: [dp(10)]
    source: ""
    RelativeLayout:
        MDIcon:
            id: ico
            icon: "image-plus"
            halign: "center"
            font_size: root.height - dp(100)
            color: app.theme_cls.disabled_hint_text_color
        FitImage:
            source: root.source
            radius: root.radius
            on_source:
                ico.opacity = 0

<PictureCard@MDCard>:
    spacing: dp(10)
    source:""
    text: ""
    Image:
        source: root.source
        allow_stretch: True
        keep_ratio: False
        size_hint_x: .5
    MDLabel:
        text: root.text